---
import PageLayout from "@/layouts/PageLayout.astro";
import ThemeDock from "@/components/domain/theme/ThemeDock.astro";
import { getEntry, getCollection } from "astro:content";

// Portfolio Components

// Portfolio Components
import WaterfallGridLayout from "@/components/domain/portfolio/WaterfallGridLayout.astro";
import StandardDividedLayout from "@/components/domain/portfolio/StandardDividedLayout.astro";
import LongPageLandingLayout from "@/components/domain/portfolio/LongPageLandingLayout.astro";
import FullBleedCarouselLayout from "@/components/domain/portfolio/FullBleedCarouselLayout.astro";
import StructuredCaseStudyLayout from "@/components/domain/portfolio/StructuredCaseStudyLayout.astro";

// E-Commerce Components
import EditorialMagazineLayout from "@/components/domain/ecommerce/EditorialMagazineLayout.astro";
import TechElectronicsLayout from "@/components/domain/ecommerce/TechElectronicsLayout.astro";
import SubscriptionLandingLayout from "@/components/domain/ecommerce/SubscriptionLandingLayout.astro";
import FoodGroceryLayout from "@/components/domain/ecommerce/FoodGroceryLayout.astro";
import DigitalProductLayout from "@/components/domain/ecommerce/DigitalProductLayout.astro";

// Corporate Components
import StrictProfessionalLayout from "@/components/domain/corporate/StrictProfessionalLayout.astro";
import IndustrialModularLayout from "@/components/domain/corporate/IndustrialModularLayout.astro";
import NonProfitImpactLayout from "@/components/domain/corporate/NonProfitImpactLayout.astro";
import RestaurantVisualLayout from "@/components/domain/corporate/RestaurantVisualLayout.astro";
import MedicalClinicLayout from "@/components/domain/corporate/MedicalClinicLayout.astro";

// Content/News Components
import ThreeColumnReviewLayout from "@/components/domain/contentNews/ThreeColumnReviewLayout.astro";
import StructuredRecipeLayout from "@/components/domain/contentNews/StructuredRecipeLayout.astro";
import TravelVisualStoryLayout from "@/components/domain/contentNews/TravelVisualStoryLayout.astro";
import GossipDenseGridLayout from "@/components/domain/contentNews/GossipDenseGridLayout.astro";
import AcademicMinimalLayout from "@/components/domain/contentNews/AcademicMinimalLayout.astro";

// Software/SaaS Components
import FreemiumSinglePageLayout from "@/components/domain/software/FreemiumSinglePageLayout.astro";
import EnterpriseSalesLayout from "@/components/domain/software/EnterpriseSalesLayout.astro";
import MobileAppVerticalLayout from "@/components/domain/software/MobileAppVerticalLayout.astro";
import ProjectManagementKanbanLayout from "@/components/domain/software/ProjectManagementKanbanLayout.astro";
import FintechDataLayout from "@/components/domain/software/FintechDataLayout.astro";

const ComponentMap = {
    // Portfolio
    WaterfallGridLayout,
    StandardDividedLayout,
    LongPageLandingLayout,
    FullBleedCarouselLayout,
    StructuredCaseStudyLayout,
    // E-Commerce
    EditorialMagazineLayout,
    TechElectronicsLayout,
    SubscriptionLandingLayout,
    FoodGroceryLayout,
    DigitalProductLayout,
    // Corporate
    StrictProfessionalLayout,
    IndustrialModularLayout,
    NonProfitImpactLayout,
    RestaurantVisualLayout,
    MedicalClinicLayout,
    // Content/News
    ThreeColumnReviewLayout,
    StructuredRecipeLayout,
    TravelVisualStoryLayout,
    GossipDenseGridLayout,
    AcademicMinimalLayout,
    // Software/SaaS
    FreemiumSinglePageLayout,
    EnterpriseSalesLayout,
    MobileAppVerticalLayout,
    ProjectManagementKanbanLayout,
    FintechDataLayout,
};

const { lang, category, theme } = Astro.params;

// Fetch themes from Content Collections
// IDs are formatted as `${category}-${lang}` (e.g., 'portfolio-en')
const entryId = `${category}-${lang}`;
const entry = await getEntry("themes", entryId);

if (!entry) {
    return Astro.redirect("/404");
}

const themes = entry.data;
const activeTheme = themes.find((t) => t.id === theme);

if (!lang || !category || !activeTheme) {
    return Astro.redirect("/404");
}
---

<PageLayout title={`Explorer - ${category}`} lang={lang}>
    <div class="pt-20 min-h-screen bg-slate-50 dark:bg-slate-900">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <h1
                class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-600 to-purple-600 mb-4 capitalize"
            >
                {category} Explorer
            </h1>

            <!-- Floating Theme Dock -->
            <ThemeDock
                themes={themes}
                activeThemeId={activeTheme.id}
                lang={lang}
                category={category}
            />

            <!-- Preview Area -->
            <div
                class={`transition-all duration-500 rounded-xl overflow-hidden shadow-2xl border border-slate-200 dark:border-slate-800 ${activeTheme.styleClasses}`}
            >
                {
                    (() => {
                        const Layout =
                            ComponentMap[
                                activeTheme.layoutComponent as keyof typeof ComponentMap
                            ] || WaterfallGridLayout;
                        return <Layout theme={activeTheme} />;
                    })()
                }
            </div>
        </div>
    </div>
</PageLayout>
