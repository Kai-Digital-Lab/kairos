---
// Server-side: 這裡不需要做什麼，主要是輸出 HTML
---

<button
    type="button"
    class="theme-toggle-btn relative inline-flex items-center justify-center w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 focus:outline-none transition-colors duration-200"
    aria-label="Toggle Dark Mode"
>
    <svg
        class="w-5 h-5 transition-transform duration-200 dark:hidden dark:rotate-90 dark:scale-0"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
    >
        <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
        ></path>
    </svg>

    <svg
        class="hidden w-5 h-5 transition-transform duration-200 dark:block dark:rotate-0 dark:scale-100"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
    >
        <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
        ></path>
    </svg>
</button>

<script>
    import { toggleTheme, themeStore } from "@/stores/theme.store";

    // 2. 改用 querySelectorAll 抓取所有按鈕 (電腦版 + 手機版)
    const buttons = document.querySelectorAll(".theme-toggle-btn");

    buttons.forEach((btn) => {
        // 防止重複綁定 (以防 View Transitions 導致 script 重跑)
        // 這裡我們直接綁定，因為 Astro 的 script 如果沒有 is:inline，通常只會執行一次
        // 但為了保險起見，簡單的 addEventListener 沒問題
        btn.addEventListener("click", (e) => {
            // 阻止事件冒泡，避免觸發其他點擊事件
            e.stopPropagation();
            toggleTheme();
        });
    });

    // 初始化狀態確保正確
    if (document.documentElement.classList.contains("dark")) {
        themeStore.set("dark");
    }
</script>
